# Документация по Python интерфейсу для ZET 017 TCP/IP

## Обзор

Данная документация охватывает два Python файла, которые предоставляют интерфейс для работы с устройствами ZET 017, ZET 038 и ZET 028 по TCP/IP:

- ```zet017tcp.py``` - Основная библиотека-обертка для TCP библиотеки ZET 017
- ```zet017_main.py``` - Пример приложения, демонстрирующий использование библиотеки

## Файл: zet017tcp.py

### Назначение

Этот файл предоставляет Python обертку для TCP библиотеки ZET 017, позволяя Python приложениям взаимодействовать с устройствами ZET 017, ZET 038 и ZET 028 по TCP/IP.

### Основные компоненты

#### Структуры данных

- ```zet017_config```: Структура конфигурации устройства
  - ```sample_rate_adc```: Частота дискретизации АЦП
  - ```sample_rate_dac```: Частота дискретизации ЦАП
  - ```mask_channel_adc```: Маска каналов АЦП
  - ```mask_icp```: Маска ICP
  - ```gain```: Значения усиления для каналов
- ```zet017_info```: Структура информации об устройстве
  - ```ip```: IP-адрес устройства
  - ```name```: Название устройства
  - ```serial```: Серийный номер
  - ```version```: Версия прошивки
- ```zet017_state```: Структура состояния устройства
  - ```connected```: Статус подключения
  - ```pointer_adc```: Указатель буфера АЦП
  - ```buffer_size_adc```: Размер буфера АЦП
  - ```pointer_dac```: Указатель буфера ЦАП

#### Основной класс: zet017tcp

#### Инициализация

```python
def __init__(self, library_path=None)
```

Автоматически определяет подходящий файл библиотеки (.dll в Windows, .so в Linux) и загружает его.

#### Основные методы

- ```init()```: Инициализировать сервер ZET 017
- ```cleanup()```: Освободить ресурсы сервера
- ```add_device(ip_address)```: Добавить устройство на сервер
- ```get_device_state(device_number)```: Получить состояние устройства
- ```get_device_info(device_number)```: Получить информацию об устройстве
- ```get_device_config(device_number)```: Получить конфигурацию устройства
- ```set_device_config(device_number, config)```: Установить конфигурацию устройства
- ```start_device(device_number)```: Запустить сбор данных
- ```stop_device(device_number)```: Остановить сбор данных
- ```get_channel_data(device_number, channel, pointer, data, size)```: Получить данные с конкретного канала

## Файл: zet017_main.py

### Назначение

Этот файл предоставляет полный пример использования библиотеки zet017tcp для взаимодействия с устройством ZET 017.

### Основные возможности

1. **Обработка сигналов**: Корректная обработка SIGINT (Ctrl+C) для graceful shutdown
2. **Обнаружение устройств:**: Автоматическое обнаружение подключения/отключения устройств
3. **Управление конфигурацией**: Настройка параметров устройства, включая частоты дискретизации и усиления
4. **Сбор данных**: Непрерывное чтение данных с указанных каналов
5. **Обработка данных**: Вычисление средних значений из полученных данных

### Основной workflow

1. Инициализация сервера ZET 017
2. Добавление устройства по IP-адресу
3. Мониторинг статуса подключения устройства
4. Настройка параметров устройства при подключении
5. Запуск сбора данных
6. Непрерывное чтение и обработка данных
7. Обработка graceful shutdown при прерывании

### Параметры конфигурации

- ```sample_rate_adc = 25000```: Частота дискретизации АЦП (25 кГц)
- ```mask_channel_adc = 0x0e```: Маска каналов АЦП
- ```mask_icp = 0x02```: Маска ICP
- ```channel = 3```: Канал для мониторинга
- ```gain = [1, 1, 1, 100, 1, 1, 1, 1]```: Значения усиления для каждого канала

## Пример использования

```python
# Инициализация библиотеки
zet017 = zet017tcp()

# Инициализация сервера
if not zet017.init():
    print("Не удалось инициализировать сервер")
    exit(-1)

# Добавление устройства
if not zet017.add_device("192.168.1.100"):
    print("Не удалось добавить устройство")
    exit(-2)

# Получение информации об устройстве
info = zet017.get_device_info(0)
print(f"Устройство: {info['name']}, Серийный номер: {info['serial']}")

# Конфигурация устройства
config = zet017.get_device_config(0)
config['sample_rate_adc'] = 25000
config['mask_channel_adc'] = 0x0e
zet017.set_device_config(0, config)

# Запуск сбора данных
zet017.start_device(0)

# Очистка ресурсов
zet017.cleanup()
```

## Обработка ошибок

Библиотека предоставляет корректную обработку ошибок через возвращаемые значения:

- True/False для булевых операций
- True/False для булевых операций
- Выбрасывание исключений для критических ошибок

## Поддерживаемые платформы

- **Windows**: Использует zet017tcp.dll
- **Linux**: Использует libzet017tcp.so

Библиотека автоматически определяет платформу и пытается найти соответствующий файл библиотеки в стандартных расположениях.

## Зависимости

- Python 3.x
- Библиотека ctypes (стандартная библиотека)
- Библиотека ZET 017 TCP (zet017tcp.dll или libzet017tcp.so)

Данный интерфейс предоставляет комплексное Python решение для работы с устройствами ZET 017, ZET 038 и ZET 028 по TCP/IP, что упрощает интеграцию этих устройств в Python-системы сбора и обработки данных.
